<!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ detalle.get('description', 'Detalle de Producto') }} | IT Data Global</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: #F1F3F4;
                min-height: 100vh;
                color: #1C2A2F;
                line-height: 1.6;
            }

            /* Header profesional */
            .header {
                background: #1C2A2F;
                color: #FFFFFF;
                padding: 1rem 0;
                box-shadow: 0 4px 20px rgba(28, 42, 47, 0.3);
                position: sticky;
                top: 0;
                z-index: 100;
                border-bottom: 3px solid #F15A29;
            }

            .header-content {
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 2rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .logo {
                font-size: 2rem;
                font-weight: 700;
                text-decoration: none;
                color: #FFFFFF;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .logo i {
                color: #F15A29;
            }

            .back-btn {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.8rem 1.5rem;
                background: #F15A29;
                color: #FFFFFF;
                text-decoration: none;
                border-radius: 12px;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .back-btn:hover {
                background: #d14a1f;
                transform: translateY(-2px);
            }

            /* Container principal */
            .main-container {
                max-width: 1400px;
                margin: 2rem auto;
                padding: 0 2rem;
            }

            /* Breadcrumb */
            .breadcrumb {
                background: #FFFFFF;
                padding: 1rem 1.5rem;
                border-radius: 16px;
                margin-bottom: 2rem;
                box-shadow: 0 4px 20px rgba(28, 42, 47, 0.08);
                border-left: 4px solid #F15A29;
            }

            .breadcrumb-list {
                display: flex;
                align-items: center;
                list-style: none;
                gap: 0.5rem;
                color: #6C757D;
                font-size: 0.9rem;
            }

            .breadcrumb-list a {
                color: #F15A29;
                text-decoration: none;
            }

            .breadcrumb-list a:hover {
                text-decoration: underline;
            }

            /* Layout del producto */
            .product-container {
                background: #FFFFFF;
                border-radius: 24px;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(28, 42, 47, 0.1);
                border: 1px solid #F1F3F4;
            }

            .product-layout {
                display: grid;
                grid-template-columns: 1fr 1fr;
                min-height: 600px;
            }

            /* Sección de imagen */
            .product-image-section {
                background: #F1F3F4;
                padding: 3rem;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
            }

            .product-image {
                max-width: 100%;
                max-height: 500px;
                object-fit: contain;
                border-radius: 16px;
                box-shadow: 0 10px 40px rgba(28, 42, 47, 0.1);
                transition: transform 0.3s ease;
            }

            .product-image:hover {
                transform: scale(1.05);
            }

            .image-badges {
                position: absolute;
                top: 2rem;
                right: 2rem;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .badge {
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .badge-available {
                background: #F15A29;
                color: #FFFFFF;
            }

            .badge-premium {
                background: #1C2A2F;
                color: #FFFFFF;
            }

            /* Sección de información */
            .product-info-section {
                padding: 3rem;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .product-brand {
                color: #F15A29;
                font-size: 1rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 0.5rem;
            }

            .product-brand i {
                margin-right: 0.5rem;
            }

            .product-title {
                font-size: 2rem;
                font-weight: 700;
                color: #1C2A2F;
                margin-bottom: 1rem;
                line-height: 1.3;
            }

            .product-sku {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                font-family: 'Monaco', 'Menlo', monospace;
                background: #F1F3F4;
                padding: 0.8rem 1.2rem;
                border-radius: 12px;
                font-size: 0.9rem;
                color: #6C757D;
                margin-bottom: 2rem;
                font-weight: 600;
                width: fit-content;
                border-left: 4px solid #F15A29;
            }

            .product-sku i {
                color: #F15A29;
            }

            .product-price {
                font-size: 2.5rem;
                font-weight: 700;
                color: #F15A29;
                margin-bottom: 1rem;
            }

            .product-availability {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 1rem 1.5rem;
                border-radius: 16px;
                font-weight: 600;
                margin-bottom: 2rem;
                font-size: 1rem;
            }

            .availability-available {
                background: #d4edda;
                color: #155724;
                border: 2px solid #c3e6cb;
            }

            .availability-limited {
                background: #fff3cd;
                color: #856404;
                border: 2px solid #ffeaa7;
            }

            /* Secciones de información adicional */
            .product-details {
                margin-top: 2rem;
            }

            .detail-section {
                background: #F1F3F4;
                padding: 2rem;
                border-radius: 16px;
                margin-bottom: 1.5rem;
                border-left: 4px solid #F15A29;
            }

            .detail-section h3 {
                color: #1C2A2F;
                font-size: 1.3rem;
                font-weight: 600;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .detail-section h3 i {
                color: #F15A29;
            }

            .detail-section p {
                color: #6C757D;
                line-height: 1.7;
                white-space: pre-line;
            }

            .attributes-list {
                list-style: none;
                display: grid;
                gap: 1rem;
            }

            .attribute-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                background: #FFFFFF;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(28, 42, 47, 0.05);
                border-left: 3px solid #F15A29;
            }

            .attribute-name {
                font-weight: 600;
                color: #1C2A2F;
            }

            .attribute-name i {
                color: #F15A29;
                margin-right: 0.5rem;
            }

            .attribute-value {
                color: #6C757D;
                text-align: right;
            }

            /* Información adicional del producto */
            .product-meta {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1.5rem;
            }

            .meta-item {
                background: #FFFFFF;
                padding: 1rem;
                border-radius: 12px;
                border-left: 3px solid #F15A29;
            }

            .meta-label {
                font-weight: 600;
                color: #1C2A2F;
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .meta-value {
                color: #6C757D;
            }

            /* Botones de acción */
            .action-buttons {
                display: flex;
                gap: 1rem;
                margin-top: 2rem;
            }

            .btn {
                padding: 1rem 2rem;
                border: none;
                border-radius: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                font-size: 1rem;
                background: none;
            }

            .btn-primary {
                background: #F15A29;
                color: #FFFFFF;
            }

            .btn-primary:hover {
                background: #d14a1f;
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(241, 90, 41, 0.3);
            }

            .btn-secondary {
                background: #F1F3F4;
                color: #6C757D;
                border: 2px solid #F1F3F4;
            }

            .btn-secondary:hover {
                background: #FFFFFF;
                border-color: #6C757D;
                color: #1C2A2F;
                transform: translateY(-2px);
            }

            .btn-favorite-active {
                background: #d4edda !important;
                color: #155724 !important;
                border-color: #c3e6cb !important;
            }

            /* Formularios ocultos */
            .hidden-form {
                display: none;
            }

            /* Quantity selector */
            .quantity-selector {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }

            .quantity-selector label {
                font-weight: 600;
                color: #1C2A2F;
            }

            .quantity-selector input {
                width: 80px;
                padding: 0.5rem;
                border: 2px solid #F1F3F4;
                border-radius: 8px;
                text-align: center;
                font-weight: 600;
            }

            /* Toast notification styles */
            .toast {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
                max-width: 300px;
                transform: translateX(100%);
            }

            .toast.show {
                transform: translateX(0);
            }

            .toast.success {
                background: #28a745;
            }

            .toast.error {
                background: #dc3545;
            }

            .toast.info {
                background: #17a2b8;
            }

            .btn-favorite-active {
                background: #d4edda !important;
                color: #155724 !important;
                border-color: #c3e6cb !important;
            }

            .btn-favorite-active:hover {
                background: #c3e6cb !important;
                border-color: #155724 !important;
            }
            /* Responsive Design */
            @media (max-width: 1024px) {
                .product-layout {
                    grid-template-columns: 1fr;
                }

                .product-image-section {
                    padding: 2rem;
                }

                .product-info-section {
                    padding: 2rem;
                }
            }

            @media (max-width: 768px) {
                .main-container {
                    padding: 0 1rem;
                }

                .product-title {
                    font-size: 1.5rem;
                }

                .product-price {
                    font-size: 2rem;
                }

                .action-buttons {
                    flex-direction: column;
                }

                .attribute-item {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.5rem;
                }

                .attribute-value {
                    text-align: left;
                }

                .product-meta {
                    grid-template-columns: 1fr;
                }
            }

            /* Animaciones */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .product-container {
                animation: fadeInUp 0.8s ease forwards;
            }

            .detail-section {
                animation: fadeInUp 0.6s ease forwards;
            }

            .detail-section:nth-child(2) { animation-delay: 0.2s; }
            .detail-section:nth-child(3) { animation-delay: 0.4s; }
        </style>
    </head>
    <body>
        <!-- Header Profesional -->
        <header class="header">
            <div class="header-content">
                <a href="/products/catalogo-completo-cards" class="logo">
                    <i class="fas fa-microchip"></i>
                    IT Data Global
                </a>
                <a href="/products/catalogo-completo-cards" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Volver al catálogo
                </a>
            </div>
        </header>
        <!-- Container Principal -->
        <div class="main-container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <ul class="breadcrumb-list">
                    <li><i class="fas fa-home"></i></li>
                    <li><i class="fas fa-chevron-right"></i></li>
                    <li><a href="/products/catalogo-completo-cards">Catálogo</a></li>
                    <li><i class="fas fa-chevron-right"></i></li>
                    <li>{{ detalle.get('vendorName', 'Producto') }}</li>
                    <li><i class="fas fa-chevron-right"></i></li>
                    <li>{{ part_number }}</li>
                </ul>
            </nav>
            <!-- Container del producto -->
            <div class="product-container">
                <div class="product-layout">
                    <!-- Sección de imagen -->
                    <div class="product-image-section">
                        <img src="{{ imagen_url }}" alt="{{ detalle.get('description', 'Producto') }}" class="product-image">
                        <div class="image-badges">
                            {% if 'Disponible' in disponibilidad %}
                            <div class="badge badge-available">
                                <i class="fas fa-check"></i> En Stock
                            </div>
                            {% endif %}
                            <div class="badge badge-premium">
                                <i class="fas fa-star"></i> Premium
                            </div>
                        </div>
                    </div>
                    <!-- Sección de información -->
                    <div class="product-info-section">
                        <div class="product-brand">
                            <i class="fas fa-tag"></i>
                            {{ detalle.get('vendorName', 'Marca no disponible') }}
                        </div>
                        <h1 class="product-title">{{ detalle.get('description', 'Sin descripción') }}</h1>
                        <div class="product-sku">
                            <i class="fas fa-barcode"></i>
                            <strong>SKU:</strong>
                            {{ detalle.get('ingramPartNumber', part_number) }}
                            
                            {% if detalle.get('vendorPartNumber') %}
                            <br>
                            <small style="font-size: 1em; opacity: 0.8; color: #6C757D;">
                                <i class="fas fa-tag"></i>
                                <strong>Vendor Part Number(VPN):</strong> {{ detalle.get('vendorPartNumber') }}
                            </small>
                            {% endif %}
                        </div>
                        <!-- Información adicional del producto -->
                        <div class="product-meta">
                            {% if detalle.get('category') %}
                            <div class="meta-item">
                                <div class="meta-label">
                                    <i class="fas fa-folder"></i> Categoría
                                </div>
                                <div class="meta-value">{{ detalle.get('category') }}</div>
                            </div>
                            {% endif %}

                            {% if detalle.get('subCategory') %}
                            <div class="meta-item">
                                <div class="meta-label">
                                    <i class="fas fa-tags"></i> Subcategoría
                                </div>
                                <div class="meta-value">{{ detalle.get('subCategory') }}</div>
                            </div>
                            {% endif %}

                            {% if detalle.get('upcCode') %}
                            <div class="meta-item">
                                <div class="meta-label">
                                    <i class="fas fa-barcode"></i> UPC Code
                                </div>
                                <div class="meta-value">{{ detalle.get('upcCode') }}</div>
                            </div>
                            {% endif %}
                        </div>

                        <div class="product-price">{{ precio_final }}</div>
                        
                        <div class="product-availability {% if 'Disponible' in disponibilidad %}availability-available{% else %}availability-limited{% endif %}">
                            <i class="fas fa-{% if 'Disponible' in disponibilidad %}check-circle{% else %}exclamation-circle{% endif %}"></i>
                            {{ disponibilidad }}
                        </div>
                        <!-- Selector de cantidad -->
                        <div class="quantity-selector">
                            <label for="quantity">Cantidad:</label>
                            <input type="number" id="quantity" value="1" min="1" max="999">
                        </div>
                        <div class="action-buttons">
                            <button type="button" class="btn btn-primary" onclick="addToQuoteFromButton('{{ detalle.get('ingramPartNumber', part_number) }}')">
                                <i class="fas fa-shopping-cart"></i>
                                Solicitar cotización
                            </button>
                            <button type="button" class="btn btn-secondary" id="favorite-btn" onclick="toggleFavorite('{{ detalle.get('ingramPartNumber', part_number) }}')">
                                <i class="fas fa-heart"></i>
                                <span id="favorite-text">Agregar a favoritos</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Detalles adicionales -->
            <div class="product-details">
                <!-- Descripción -->
                <div class="detail-section">
                    <h3>
                        <i class="fas fa-info-circle"></i>
                        Descripción del producto
                    </h3>
                    <p>{{ detalle.get('description', 'Descripción no disponible') }}</p>
                </div>
                <!-- Especificaciones técnicas -->
                {% if atributos %}
                <div class="detail-section">
                    <h3>
                        <i class="fas fa-cogs"></i>
                        Especificaciones técnicas
                    </h3>
                    <ul class="attributes-list">
                        {% for a in atributos %}
                        <li class="attribute-item">
                            <span class="attribute-name">{{ a.name }}</span>
                            <span class="attribute-value">{{ a.value }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                <!-- Información adicional -->
                <div class="detail-section">
                    <h3>
                        <i class="fas fa-shield-alt"></i>
                        Información adicional
                    </h3>
                    <div style="display: grid; gap: 1rem;">
                        <div class="attribute-item">
                            <span class="attribute-name">
                                <i class="fas fa-truck"></i>
                                Envío
                            </span>
                            <span class="attribute-value">Disponible a toda la república</span>
                        </div>
                        {% if detalle.get('endUserRequired') %}
                        <div class="attribute-item">
                            <span class="attribute-name">
                                <i class="fas fa-user"></i>
                                Requiere usuario final
                            </span>
                            <span class="attribute-value">{{ 'Sí' if detalle.get('endUserRequired') == 'True' else 'No' }}</span>
                        </div>
                        {% endif %}
                        {% if detalle.get('hasWarranty') %}
                        <div class="attribute-item">
                            <span class="attribute-name">
                                <i class="fas fa-certificate"></i>
                                Garantía
                            </span>
                            <span class="attribute-value">{{ 'Sí' if detalle.get('hasWarranty') == 'True' else 'No' }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Formularios ocultos para las acciones -->
        <form id="quote-form" class="hidden-form" method="POST" action="/agregar-cotizacion">
            <input type="hidden" name="part_number" value="{{ detalle.get('ingramPartNumber', part_number) }}">
            <input type="hidden" name="description" value="{{ detalle.get('description', 'Sin descripción') }}">
            <input type="hidden" name="vendor" value="{{ detalle.get('vendorName', '') }}">
            <input type="hidden" name="price" value="{{ detalle.get('pricing', {}).get('customerPrice', '0') }}">
            <input type="hidden" name="quantity" id="quote-quantity" value="1">
        </form>

        <form id="favorite-form" class="hidden-form" method="POST" action="/agregar-favorito">
            <input type="hidden" name="part_number" value="{{ detalle.get('ingramPartNumber', part_number) }}">
            <input type="hidden" name="description" value="{{ detalle.get('description', 'Sin descripción') }}">
            <input type="hidden" name="vendor" value="{{ detalle.get('vendorName', '') }}">
        </form>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const partNumber = '{{ detalle.get("ingramPartNumber", part_number) }}';
                
                // Inicializar funcionalidades
                initializeProductActions(partNumber);
                initializeImageEffects();
                initializeAnimations();
                initializeSKUCopy(partNumber);
                checkFavoriteStatus(partNumber);
            });
            function initializeProductActions(partNumber) {
                const quoteBtn = document.getElementById('add-to-quote-btn');
                const favoriteBtn = document.getElementById('favorite-btn');
                const quantityInput = document.getElementById('quantity');
                
                // Configurar botón de cotización
                if (quoteBtn) {
                    quoteBtn.addEventListener('click', function() {
                        const quantity = quantityInput ? parseInt(quantityInput.value) || 1 : 1;
                        addToQuote(partNumber);
                    });
                }
                
                // Configurar botón de favoritos
                if (favoriteBtn) {
                    favoriteBtn.addEventListener('click', function() {
                        toggleFavorite(partNumber);
                    });
                }
                // Validar cantidad
                if (quantityInput) {
                    quantityInput.addEventListener('change', function() {
                        if (this.value < 1) this.value = 1;
                        if (this.value > 999) this.value = 999;
                    });
                }
            }
            function removeFromQuote(productId, form) {
                if (confirm('¿Eliminar este producto de la cotización?')) {
                    // Mostrar loading en el botón
                    const button = form.querySelector('button');
                    const originalHtml = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    button.disabled = true;
                    
                    fetch('/products/api/remove-from-quote', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ product_id: productId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Producto eliminado correctamente', 'success');
                            // Redirigir después de 1 segundo
                            setTimeout(() => {
                                window.location.href = '/products/mi-cotizacion';
                            }, 1000);
                        } else {
                            alert('Error: ' + data.error);
                            button.innerHTML = originalHtml;
                            button.disabled = false;
                        }
                    })
                    .catch(error => {
                        alert('Error de conexión');
                        button.innerHTML = originalHtml;
                        button.disabled = false;
                    });
                }
            }
            
            async function addToQuote(partNumber) {
                const quantityInput = document.getElementById('quantity');
                let quantity = 1;
                
                if (quantityInput && quantityInput.value) {
                    quantity = parseInt(quantityInput.value) || 1;
                    if (quantity < 1) quantity = 1;
                    if (quantity > 999) quantity = 999;
                }
                
                const btn = document.querySelector('[onclick*="addToQuote"]') || 
                            document.getElementById('add-to-quote-btn');
                
                if (btn) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Agregando...';
                    btn.disabled = true;
                    
                    try {
                        const response = await fetch('/products/api/add-to-quote', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                part_number: partNumber,
                                quantity: quantity
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            showNotification(`Agregado ${quantity} unidad(es) a cotización`, 'success');
                            
                            // REDIRIGIR A LA PÁGINA DE COTIZACIÓN DESPUÉS DE 1.5 SEGUNDOS
                            setTimeout(() => {
                                window.location.href = '/products/mi-cotizacion';
                            }, 1500);
                            
                        } else {
                            showNotification('Error: ' + result.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Error de conexión', 'error');
                    } finally {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                }
            }

            // SOLO DEBE HABER UNA FUNCIÓN toggleFavorite - ELIMINA LA DUPLICADA

            async function toggleFavorite(partNumber) {
                const btn = document.getElementById('favorite-btn');
                const text = document.getElementById('favorite-text');
                
                if (btn && text) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
                    btn.disabled = true;
                    
                    try {
                        const response = await fetch('/products/api/toggle-favorite', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                part_number: partNumber
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            if (result.action === 'added') {
                                btn.classList.add('btn-favorite-active');
                                text.textContent = 'En favoritos';
                                showNotification('Agregado a favoritos', 'success');
                                
                                // Redirigir a favoritos después de agregar
                                setTimeout(() => {
                                    window.location.href = '/products/mis-favoritos';
                                }, 1500);
                                
                            } else {
                                btn.classList.remove('btn-favorite-active');
                                text.textContent = 'Agregar a favoritos';
                                showNotification('Eliminado de favoritos', 'info');
                            }
                        } else {
                            showNotification('Error: ' + result.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Error de conexión', 'error');
                    } finally {
                        btn.innerHTML = originalText.replace('fa-spinner fa-spin', 'fa-heart');
                        btn.disabled = false;
                    }
                }
            }

            // Esta función auxiliar para el botón
            function addToQuoteFromButton(partNumber) {
                const quantityInput = document.getElementById('quantity');
                const quantity = quantityInput ? parseInt(quantityInput.value) || 1 : 1;
                addToQuote(partNumber);
            }
            async function checkFavoriteStatus(partNumber) {
                try {
                    const response = await fetch(`/products/api/check-favorite/${partNumber}`);
                    const data = await response.json();
                    
                    if (data.success && data.is_favorite) {
                        const favoriteBtn = document.getElementById('favorite-btn');
                        const favoriteText = document.getElementById('favorite-text');
                        
                        if (favoriteBtn && favoriteText) {
                            favoriteBtn.classList.add('btn-favorite-active');
                            favoriteText.textContent = 'En favoritos';
                        }
                    }
                } catch (error) {
                    console.error('Error verificando favoritos:', error);
                }
            }

            function initializeImageEffects() {
                const productImage = document.querySelector('.product-image');
                if (productImage) {
                    productImage.addEventListener('click', function() {
                        if (this.style.transform === 'scale(2)') {
                            this.style.transform = 'scale(1)';
                            this.style.cursor = 'zoom-in';
                        } else {
                            this.style.transform = 'scale(2)';
                            this.style.cursor = 'zoom-out';
                        }
                    });
                    
                    // Añadir cursor pointer
                    productImage.style.cursor = 'zoom-in';
                    productImage.title = 'Clic para ampliar imagen';
                }
            }

            function initializeAnimations() {
                const sections = document.querySelectorAll('.detail-section');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.opacity = '1';
                            entry.target.style.transform = 'translateY(0)';
                        }
                    });
                });

                sections.forEach(section => {
                    section.style.opacity = '0';
                    section.style.transform = 'translateY(30px)';
                    section.style.transition = 'all 0.6s ease';
                    observer.observe(section);
                });
            }

            function initializeSKUCopy(partNumber) {
                const skuElement = document.querySelector('.product-sku');
                if (skuElement) {
                    skuElement.addEventListener('click', function() {
                        navigator.clipboard.writeText(partNumber).then(() => {
                            // Guardar el contenido original
                            const originalHTML = this.innerHTML;
                            const originalBackground = this.style.background;
                            const originalColor = this.style.color;
                            const originalBorderColor = this.style.borderColor;
                            
                            // Mostrar feedback visual
                            this.innerHTML = '<i class="fas fa-check" style="color: #F15A29;"></i> SKU copiado';
                            this.style.background = '#d4edda';
                            this.style.color = '#155724';
                            this.style.borderColor = '#c3e6cb';
                            
                            // Restaurar después de 2 segundos
                            setTimeout(() => {
                                this.innerHTML = originalHTML;
                                this.style.background = originalBackground;
                                this.style.color = originalColor;
                                this.style.borderColor = originalBorderColor;
                            }, 2000);
                        }).catch(err => {
                            console.error('Error al copiar SKU:', err);
                            showNotification('Error al copiar el SKU', 'error');
                        });
                    });
                    
                    // Añadir cursor pointer y tooltip
                    skuElement.style.cursor = 'pointer';
                    skuElement.title = 'Clic para copiar SKU';
                }
            }

            function updateQuoteCounter(count) {
                // Buscar y actualizar el contador en el navbar
                const quoteCounter = document.getElementById('quote-counter');
                if (quoteCounter) {
                    quoteCounter.textContent = count;
                    quoteCounter.style.display = count > 0 ? 'inline-block' : 'none';
                }
                
                // También puedes mostrar una notificación con el conteo
                console.log('Items en cotización:', count);
            }

            function showNotification(message, type = 'info') {
                // Crear notificación toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                // Estilos básicos para el toast
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.right = '20px';
                toast.style.padding = '12px 20px';
                toast.style.borderRadius = '8px';
                toast.style.color = 'white';
                toast.style.zIndex = '10000';
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                
                switch(type) {
                    case 'success':
                        toast.style.background = '#28a745';
                        break;
                    case 'error':
                        toast.style.background = '#dc3545';
                        break;
                    case 'warning':
                        toast.style.background = '#ffc107';
                        toast.style.color = '#000';
                        break;
                    default:
                        toast.style.background = '#17a2b8';
                }
                
                document.body.appendChild(toast);
                
                // Mostrar toast
                setTimeout(() => {
                    toast.style.opacity = '1';
                }, 100);
                
                // Ocultar y remover después de 3 segundos
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            // Mostrar notificación si hay mensaje flash del servidor
            "{% with messages = get_flashed_messages(with_categories=true) %}"
                "{% if messages %}"
                    "{% for category, message in messages %}"
                        document.addEventListener('DOMContentLoaded', function() {
                            showNotification('{{ message }}', '{{ category }}');
                        });
                    "{% endfor %}"
                "{% endif %}"
            "{% endwith %}"
        </script>
    </body>
    </html>